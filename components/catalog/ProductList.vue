<template>
  <div class="box">
    <transition name="loadOut">
      <div v-show="isLoad" class="loadBox">
        <svg
          class="logo"
          xmlns="http://www.w3.org/2000/svg"
          xml:space="preserve"
          width="120px"
          height="120px"
          version="1.1"
          style="
            shape-rendering: geometricPrecision;
            text-rendering: geometricPrecision;
            image-rendering: optimizeQuality;
            fill-rule: evenodd;
            clip-rule: evenodd;
          "
          viewBox="0 0 12000 12000"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          xmlns:xodm="http://www.corel.com/coreldraw/odm/2003"
        >
          <defs>
            <style type="text/css">
              .element {
                fill: #e57657;
              }
            </style>
          </defs>
          <g id="logo">
            <path
              class="make element"
              d="M6409 7633c-287,0 -172,-602 -174,-965 -1,-446 139,-767 -421,-767 -175,0 -174,58 -272,124 -727,-350 -1633,35 -1633,1138 0,220 63,164 -69,326 -60,71 -155,168 -277,168 -245,0 -75,-829 -102,-1085 -74,-705 -769,-788 -1184,-571 -89,47 -247,148 -273,246l-49 0c-87,-324 -636,-451 -999,-256 -116,63 -151,123 -263,182 -32,-378 -693,-284 -693,0l0 1880c0,307 660,368 693,-49 29,-371 45,-831 242,-1144 85,-134 184,-300 376,-316 222,331 -9,1197 59,1501 81,360 691,341 710,-89 19,-431 50,-877 284,-1225 167,-246 383,-224 383,11 0,464 -241,1214 378,1502 408,190 894,15 1081,-265 221,148 236,347 841,347 145,0 278,-50 373,-98 216,-111 179,-168 296,-199 61,230 383,297 643,297 194,0 350,-142 470,-223 2,106 16,138 86,186 106,71 600,180 608,-259 6,-402 -22,-268 147,-521 69,50 144,197 198,273 188,264 564,519 940,519 307,0 624,-242 817,-371 370,552 1476,583 2023,44 160,-158 352,-395 352,-663 0,-185 -277,-377 -489,-192 -116,101 -184,541 -786,600 -181,17 -309,-52 -457,-86 60,-81 33,-37 162,-61 82,-14 134,-37 189,-59 230,-92 400,-231 514,-450 144,-274 121,-604 -48,-842 -246,-346 -837,-389 -1287,-48 -238,179 -377,478 -432,780 -54,296 80,257 -131,464 -410,402 -748,190 -1004,-271 -56,-101 -171,-268 -108,-369 54,-86 195,-223 314,-233 0,171 -49,210 -49,347 0,153 717,413 717,-421 0,-286 -286,-569 -569,-569 -302,0 -449,40 -687,278l-352 464c0,-233 64,-1083 -23,-1263 -77,-157 -410,-216 -579,-32 -90,99 -66,162 -65,331 1,156 -27,205 -26,370l1 1189c-12,141 -264,395 -397,395l1 0 0 0zm3599 -673c28,-92 86,-254 181,-341 95,-87 228,-100 304,-104 76,-4 94,0 114,19 20,19 40,51 52,87 11,35 13,72 6,106 -7,35 -24,66 -76,101 -53,36 -143,75 -250,121 -106,45 -231,97 -294,111 -63,15 -65,-8 -37,-100zm-4975 -278c134,-24 267,-49 338,13 71,62 80,211 89,359l0 0c5,28 7,56 7,85 0,252 -181,457 -404,457 -223,0 -404,-205 -404,-457 0,-242 165,-439 374,-457l0 0 0 0 0 0z"
            />
            <path
              class="top element"
              d="M668 4936c0,235 115,396 347,396 427,0 329,-591 725,-1377 66,-132 113,-215 185,-335 224,-371 402,-578 704,-880 725,-724 1901,-1293 2938,-1293 830,0 1442,50 2178,421 1210,611 2044,1526 2433,2836 41,137 64,298 111,409 144,345 672,267 672,-152 0,-414 -412,-1293 -620,-1657 -153,-267 -289,-434 -472,-666l-263 -306c-104,-117 -202,-178 -309,-285 -727,-723 -2201,-1317 -3260,-1317 -914,0 -1497,67 -2300,421 -716,316 -1463,841 -1959,1455 -346,429 -642,900 -852,1425 -74,184 -258,690 -258,905l0 0 0 0z"
            />
            <path
              class="bottom element"
              d="M5592 11270c716,0 1243,-27 1908,-269 517,-188 1010,-432 1429,-749 46,-35 84,-62 127,-95l572 -516c213,-266 543,-488 386,-814 -68,-142 -196,-180 -340,-180 -177,0 -296,199 -389,304l-334 358c-118,119 -241,213 -373,321 -613,495 -1721,922 -2541,922 -718,0 -902,3 -1623,-208l-497 -195c-166,-84 -300,-151 -452,-241 -69,-42 -141,-80 -214,-133 -72,-53 -134,-92 -200,-145 -601,-486 -514,-506 -866,-867 -293,-300 -746,18 -584,386l385 482c863,934 2342,1639 3606,1639l0 0 0 0z"
            />

            <path
              class="o element"
              d="M3390 4268c0,149 101,359 178,440 363,385 1133,227 1133,-490 0,-165 -102,-339 -190,-427 -407,-407 -1121,-108 -1121,477zm655 -394c213,0 384,172 384,384 0,212 -171,384 -384,384 -211,0 -383,-172 -383,-384 0,-212 172,-384 383,-384z"
            />
            <path
              class="e2 element"
              d="M8264 3699l0 1188 717 0c73,-313 36,-248 -445,-248l0 -297c504,0 445,47 445,-198 0,-116 -151,-74 -445,-74l0 -173c445,0 522,57 445,-272 -132,0 -264,0 -395,0 -125,-1 -322,-40 -322,74l0 0 0 0z"
            />
            <path
              class="e1 element"
              d="M7126 3699l0 1113c0,57 17,75 74,75l594 0c110,0 110,-248 0,-248l-396 0 0 -297c505,0 445,47 445,-198 0,-116 -152,-74 -445,-74l0 -173c445,0 522,57 445,-272 -132,0 -264,0 -396,0 -123,-1 -321,-40 -321,74l0 0 0 0z"
            />
            <path
              class="c element"
              d="M2202 4268c0,461 465,752 858,611 87,-31 85,-48 157,-67 0,-555 -57,-166 -350,-156 -88,3 -220,-53 -276,-109 -180,-180 -181,-675 279,-675 309,0 347,373 347,-173 -123,-28 -177,-99 -347,-99 -389,0 -668,284 -668,668l0 0z"
            />
            <path
              class="f1 element"
              d="M4973 3699l0 1113c0,102 78,75 273,75l0 -545c448,0 395,44 395,-198 0,-112 -127,-74 -395,-74l0 -173c448,0 395,44 395,-198 0,-127 -244,-74 -594,-74 -57,0 -74,17 -74,74l0 0 0 0z"
            />
            <path
              class="f2 element"
              d="M6062 4887l247 0 0 -545c449,0 396,44 396,-198 0,-112 -127,-74 -396,-74l0 -173c477,0 421,46 421,-198 0,-57 -17,-74 -74,-74l-594 0 0 1262 0 0 0 0z"
            />
          </g>
        </svg>
      </div>
    </transition>

    <transition name="productIn">
      <div v-show="!isLoad" id="product-list-box">
        <Card v-for="(item, index) in items" :key="index" :item="item" />
      </div>
    </transition>

    <transition name="loadOut">
      <div v-if="items.length === 0 && !isLoad" class="emptyBox">
        <h1 class="emptyPreview">☹</h1>
        <h4>Ой! Кажется здесь ничего нет...</h4>
      </div>
    </transition>
  </div>
</template>

<script>
export default {
  props: {
    selected: { type: Object, required: true },
    sort: { type: Object, required: true },
    search: { type: String, required: true },
  },
  data() {
    return {
      isLoad: true,
      items: [],
    }
  },
  computed: {},
  watch: {
    selected: {
      deep: true,
      handler() {
        this.update()
      },
    },
    sort: {
      deep: true,
      handler() {
        this.update()
      },
    },
    search(val) {
      this.update()
    },
  },
  mounted() {
    this.load(1000)
    this.update()
  },
  methods: {
    load(time) {
      setTimeout(() => {
        this.isLoad = false
      }, time)
    },
    async update() {
      // Получение товаров
      this.isLoad = true
      const characteristics = {}
      for (const [title, values] of Object.entries(this.selected))
        if (values.length) characteristics[title] = values

      await this.$store
        .dispatch('api/getProducts', {
          category: '/Кофе',
          sort: this.sort,
          title: this.search,
          characteristics,
          inStock: true,
          // limit: 12,
        })
        .then((res) => {
          this.items = res
        })
        .catch(() => {
          this.items = []
        })
      this.load(700)
    },
  },
}
</script>

<style scoped lang="scss">
.box {
  position: relative;
  // background: blue;
}
#product-list-box {
  // overflow: scroll;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  justify-items: center;
  align-items: center;
  gap: 3rem 1.5rem;
  width: 100%;
  // height: 100%;
  // background: forestgreen;
}
#paginationBox {
  height: 10%;
  width: 100%;
  background: brown;
}
.loadBox {
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  width: 100%;
  // background: red;
}
.logo {
  // width: 100%;
}
.emptyBox {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  padding: 14% 2rem;
  color: gray;
  // height: 100%;
  // background: fuchsia;
}
.emptyPreview {
  width: 100%;
  color: $main-light-color;
  text-align: center;
  // background: gold;
}

.loadOut-enter-active {
  transition: all 1.5s;
}
.loadOut-leave-active {
  transition: all 0.5s;
}
.loadOut-enter {
  transform: scale(0.5);
  opacity: 0;
}
.loadOut-leave-to {
  transform: scale(2);
  opacity: 0;
}

.productIn-enter-active {
  transition: all 0.5s;
}
.productIn-leave-active {
  transition: all 0s;
}
.productIn-enter {
  transform: scale(0.9);
  opacity: 0;
}
.productIn-leave-to {
  opacity: 0;
}
////////////////////////////////////////////////////////////
@keyframes appear {
  0% {
    opacity: 0;
    transform: translateX(-2000px);
  }
  100% {
    opacity: 1;
  }
}

@keyframes rotatetop {
  0% {
  }
  60% {
    transform: rotate(360deg);
  }
  80% {
    transform: translateY(-7000px);
  }
  100% {
    opacity: 0;
  }
}

@keyframes rotatebottom {
  0% {
  }
  60% {
    transform: rotate(360deg);
  }
  80% {
    transform: translateY(7000px);
  }
  100% {
    opacity: 0;
  }
}
.bottom {
  opacity: 0;
  transform-origin: 50% 50%;
  animation: appear 0.3s ease forwards, rotatebottom 0.6s ease-in 1s forwards;
}

@keyframes top {
  0% {
    opacity: 0;
    transform: translateY(-1000px);
  }
  50% {
  }
  100% {
    opacity: 1;
  }
}

.top {
  opacity: 0;
  transform-origin: 50% 50%;
  animation: top 0.3s ease 0.5s forwards, rotatetop 0.6s ease-in 1s forwards;
}
////////////////////////////////////////////////////////////

@media screen and (max-width: $mobile) {
  #product-list-box {
    grid-template-columns: 1fr;
    grid-template-columns: 1fr 1fr;
    gap: 2rem 0.8rem;
  }
  .card-card {
    margin: 0rem;
    justify-self: center;
  }
  .loadBox {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: none;
    background: transparent;
    // background: red;
  }
}
</style>
